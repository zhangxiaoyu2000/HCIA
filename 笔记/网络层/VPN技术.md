## VPN（Virtual Private Network）技术引入

> 在学习VPN技术之前我们需要了解为什么会引入VPN技术，VPN技术的基本原理、VPN的技术的几种实现

IP地址分划：

- A类地址

  1.0.0.1~126.255.255.254

  A类IP地址中的私有地址和保留地址

  `10.X.X.X`是私有地址

  `127.X.X.X`是保留地址，用做循环测试用的

- B类地址

  128.0.0.1~191.255.255.254

   B类IP地址的私有地址和保留地址

  `172.16.0.0---172.31.255.254`是私有地址

  `169.254.X.X`是保留地址。如果你的IP地址是自动获取IP地址，而你在网络上又没有找到可用的DHCP[服务器](https://cloud.tencent.com/product/cvm/?from_column=20065&from=20065)。就会得到其中一个IP。

  `191.255.255.255`是广播地址，不能分配。

- C类地址

  192.0.0.1---223.255.255.254

  C类地址中的私有地址

  `192.168.X.X`是私有地址。（`192.168.0.1---192.168.255.255`)

- D类地址

  224.0.0.1---239.255.255.254

- E类地址

  240.0.0.1---255.255.255.254

> 所谓的私有地址就是在互联网上不使用，而被用在局域网络中的地址

子网掩码简介：

> 在因特网中A类，B类和C类IP地址经常被使用，经过网络号和主机号的层次划分，它们能适应不同的网络规模。随着计算机和网络技术的发展，小型网络越来越多，它们使用C类网络号是一种浪费。因此在实际应用中，对IP地址进行再次划分，使其第三个字节代表网号，其余部分为主机号。再次划分后的IP地址的网络号部分和主机号部分用子网掩码（也称子网屏蔽码）来区分。
>
> 子网掩码同样也以4个字节来表示，是32位二进制数值，对应于IP地址的32位二进制数值。对于IP地址的32位二进制数值。对于IP地址中的网络号都分在子网掩码中用“1”表示，对于IP地址中的主机号部分在子网掩码中用“0”表示。子网掩码的作用是用来区分网络上的主机是否在同一网络区段内，或者说，子网掩码用来区分IP地址的网络号和主机号。
>
> 缺省状态下，如果没有进行子网划分：
>
> - A类网络的子网掩码为`255.0.0.0`
> - B类网络的子网掩码为`255.255.0.0`
> - C类网络的子网掩码为`255.255.255.0`
>
> 主机号中全0是保留地址，全1是广播地址，所以它们不算可用主号地址

私有地址是不允许传输在公网上的（源IP是私有地址或者目的IP是私有地址），从而一个局域网要访问公网就需要引入NAT（Network address transform），为何有NAT技术还需要引入VPN技术呢？

NAT（Network Address Translation）和VPN（Virtual Private Network）都是网络技术，它们的作用有所不同，尽管它们可能在某些场景下可以互补使用。理解这两者的区别有助于解释为什么即使有NAT技术，仍然需要VPN技术。

**NAT（网络地址转换）**

NAT技术主要解决的是局域网内设备与公网通信时的IP地址问题，特别是当局域网使用私有IP地址时。NAT会将私有IP地址转换为公有IP地址，这样局域网中的多个设备可以共享一个公网IP地址进行访问。

**NAT的作用：**

1. **IP地址节省**：通过NAT，多个内部设备可以共享一个公网IP，解决了IPv4地址紧张的问题。
2. **安全性**：NAT能够在一定程度上隐藏内部网络的结构和IP地址，使得外部网络无法直接访问内部网络的设备。

但是，NAT并不涉及对网络流量的加密和隐私保护，它只是一个地址转换机制。

**VPN（虚拟专用网络）**

VPN则是一种通过公共网络（如互联网）建立一个安全的、加密的连接，以保证数据传输的隐私性和完整性。VPN技术常用于远程访问和跨地域的安全通信。

**VPN的作用：**

1. **加密**：VPN将数据加密后传输，防止数据在传输过程中被窃听或篡改。
2. **安全性**：通过VPN建立的隧道（tunnel）可以让远程设备与企业内部网络进行安全通信，避免了公共网络的安全威胁。
3. **绕过地理限制**：VPN可以隐藏真实的IP地址，使用户能够绕过地理位置限制，访问受限的内容。

**为什么有NAT技术还需要VPN技术？**

尽管NAT可以解决IP地址共享和一定程度的安全问题，但它并没有提供**加密**和**隐私保护**的功能。而VPN的核心就是**加密传输**和**隐私保护**，它通过隧道技术使得数据在公网中传输时受到保护，防止被监听、修改或者截取。

总结来说，NAT和VPN是两个不同层面的技术：

- **NAT**是解决IP地址映射和网络地址共享的问题，主要关注网络层的流量转发和路由。
- **VPN**则是确保数据安全和隐私的技术，主要关注在公网中传输的数据的保密性和完整性。

因此，即使有NAT技术，很多情况下还是需要VPN来保证通信的安全性，特别是在远程办公、跨地域连接、以及需要绕过网络限制的场景下。

> #### VPN加密的内容：
>
> - **源IP和目的IP**：在VPN的隧道内，VPN服务器和客户端之间的通信会被加密，所以外部的网络无法看到真实的源IP和目的IP地址。实际传输的是通过VPN隧道的虚拟IP地址（如VPN服务器的公网IP）。因此，通过VPN进行通信时，外部只看到VPN服务器的IP地址，而看不到客户端和服务器的真实IP地址。
> - **数据包内容**：除了IP头（源IP、目的IP等）被加密外，VPN还会对**数据包的内容**进行加密。例如，TCP/IP层的数据部分（如HTTP请求的内容）会被加密，防止网络中的恶意用户监听和解密。VPN加密的是整个数据包（包括数据部分和头部信息）。
>
> #### VPN的隐私保护：
>
> - VPN确保**源IP地址和目的IP地址**对外部不可见。这样，即使你的数据通过公用的网络传输，外部的网络或中间人无法直接知道数据传输的源和目标。
> - VPN隧道内部的加密意味着即使攻击者能够截获网络流量（例如中间人攻击），他们也无法解密数据，因为数据是加密的。
>
> #### **NAT与VPN加密的区别**
>
> NAT（网络地址转换）和VPN加密技术各自解决的是不同的问题：
>
> - **NAT**：它改变数据包中的IP地址部分，但不会加密数据或保护数据的内容。NAT仅仅是用来处理地址映射的问题，适用于私有IP地址和公网IP地址之间的转换。
> - **VPN**：VPN会对数据包的内容进行加密，保护数据的机密性。即使数据包经过NAT转换，VPN仍然能够确保加密后的数据在传输过程中不被泄露。

## VPN基本原理

VPN（虚拟专用网络，Virtual Private Network）的基本原理是通过公共网络（如互联网）建立一个加密的、安全的隧道，使得用户或设备能够像通过专用网络一样进行安全的远程访问和数据传输。VPN在网络中为用户提供了加密、隐私保护和安全的远程连接，确保数据在公网上的传输不受监听或篡改。

### 1. **基本概念和架构**

VPN技术通常涉及以下几个主要组件：

- **VPN客户端**：安装在用户设备上的软件或硬件，用来发起VPN连接。
- **VPN服务器**：提供VPN连接服务的服务器，它接受客户端的连接请求，并通过建立加密隧道来保护数据传输。
- **隧道**：VPN的加密通道，是通过公共网络（如互联网）实现私有网络连接的核心。数据通过这个隧道传输时，内容被加密，从而保护数据的机密性和完整性。
- **加密**：VPN使用加密技术对数据进行保护，防止在传输过程中被第三方截获或篡改。

### 2. **VPN的工作原理**

VPN的工作原理可以分为以下几个步骤：

#### 1) **客户端发起连接**

当用户希望通过VPN连接到远程网络时，首先在其设备（如计算机、手机）上启动VPN客户端。VPN客户端会向VPN服务器发送连接请求。

#### 2) **身份验证**

VPN服务器收到请求后，会进行**身份验证**，确保请求连接的设备是经过授权的。常见的身份验证方式包括：

- **用户名/密码**（基本的身份验证方式）。
- **证书认证**（通过数字证书进行更安全的身份验证）。
- **双因素认证**（如结合密码和手机验证码）。

#### 3) **隧道的建立**

一旦身份验证通过，VPN客户端和服务器会使用特定的协议和密钥交换算法建立一个加密的隧道。这一过程通常使用SSL/TLS、IPSec、L2TP等协议，来确保数据在隧道内传输时的保密性和安全性。

- **SSL/TLS**（常用于SSL VPN）：通过在客户端和服务器之间建立一个安全的TLS连接来创建隧道，适合Web应用。
- **IPSec**（Internet Protocol Security）：是一种加密协议，通常用于站点到站点的VPN连接，确保IP层数据的加密和验证。
- **L2TP**（Layer 2 Tunneling Protocol）：常与IPSec结合使用，为VPN连接提供更强的加密和认证。

#### 4) **数据加密与传输**

一旦隧道建立成功，所有的网络通信数据都会在**加密隧道**中进行传输。此时，数据流量的内容会被加密，防止在公共网络中被窃听。即使恶意的第三方截获了这些数据，他们也无法解密和读取数据内容。

- **加密技术**：常用的加密算法包括AES（Advanced Encryption Standard）、3DES（Triple DES）、RSA等。
- **封装与解封装**：数据在传输过程中会被封装成加密的“数据包”，这些数据包通过隧道传输到目标设备，目标设备（如VPN服务器）会解封装并还原数据。

#### 5) **数据解密与接收**

当数据到达目的地（如VPN服务器或远程网络的接收设备）时，VPN隧道会将加密数据解密，恢复出原始数据内容。此时，数据才会继续传送到目标应用程序或服务。

#### 6) **隐私保护与隐藏IP地址**

VPN会**隐藏源IP地址**，即使你的设备和服务器之间的通信发生在公网上，外部网络无法看到你设备的真实IP地址。VPN服务器通常会将流量的源地址更改为服务器的公网IP，这样你的真实位置和身份就得到了隐蔽。

##  **常见的VPN协议**

VPN的工作原理依赖于不同的协议来建立加密隧道和确保数据安全。以下是几种常见的VPN协议：

- **PPTP（Point-to-Point Tunneling Protocol）**：较为旧式的VPN协议，虽然速度较快，但加密强度较弱，已被认为不够安全。
- **L2TP（Layer 2 Tunneling Protocol）**：比PPTP更安全，但通常与IPSec结合使用来加强加密。
- **IPSec（Internet Protocol Security）**：在IP层工作，常与L2TP一起使用，提供强大的加密和数据验证。
- **SSL VPN（Secure Socket Layer VPN）**：基于SSL/TLS协议，可以通过Web浏览器访问，常用于远程用户的连接，使用方便，支持不同操作系统。
- **OpenVPN**：一个开源的VPN协议，基于SSL/TLS，支持多种加密算法，灵活且安全，是许多商业VPN服务的基础。
- **WireGuard**：新兴的VPN协议，设计简洁、快速，并提供强加密，正在逐渐成为流行选择。

##  **VPN的应用场景**

VPN被广泛用于以下几种场景：

- **远程访问**：允许员工通过互联网安全地连接到公司内网，访问公司资源。
- **跨地域网络连接**：通过VPN连接两个或多个地理位置不同的办公室或数据中心，形成一个虚拟的私有网络。
- **绕过地理限制**：VPN可隐藏用户的真实IP地址，允许用户访问在某些地区被限制或审查的内容。
- **增强安全性**：在公共Wi-Fi网络上，使用VPN可以加密用户的网络流量，防止被黑客窃听。



## VPN技术的常见协议的实现

### PPTP（Point-to-Point Tunneling Protocol）





### L2TP（Layer 2 Tunneling Protocol）



### IPSec（Internet Protocol Security）



### SSL VPN（Secure Socket Layer VPN）



### OpenVPN



### WireGuard
